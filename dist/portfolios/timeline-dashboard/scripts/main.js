"use strict";var data={timelineDay:{1:{fullName:"Фролова Олеся Матвеевна",department:{id:"1",name:"Отдел 1"},statArr:{1:{time_type:"presence",time_rel:"10"},2:{time_type:"other",time_rel:"5"},3:{time_type:"relax",time_rel:"5"},4:{time_type:"absence",time_rel:"7"},5:{time_type:"presence",time_rel:"30"},6:{time_type:"absence",time_rel:"15"}},statSum:{presence:"8ч 23м",other:"4ч 20м",absence:"3ч 40м"}},2:{fullName:"Симонов Артём Александрович",department:{id:"1",name:"Отдел 1"},statArr:{1:{time_type:"presence",time_rel:"18.9"},2:{time_type:"other",time_rel:"18.7"},3:{time_type:"absence",time_rel:"19"},4:{time_type:"presence",time_rel:"39.4"},5:{time_type:"absence",time_rel:"4"}},statSum:{presence:"8ч 23м",other:"4ч 20м",absence:"3ч 40м"}},3:{fullName:"Романова Кира Максимовна",department:{id:"2",name:"Отдел 2"},statArr:{1:{time_type:"presence",time_rel:"18.9"},2:{time_type:"other",time_rel:"18.7"},3:{time_type:"absence",time_rel:"19"},4:{time_type:"presence",time_rel:"39.4"},5:{time_type:"absence",time_rel:"4"}},statSum:{presence:"8ч 23м",other:"4ч 20м",absence:"3ч 40м"}},4:{fullName:"Мальцева Алиса Тимуровна",department:{id:"2",name:"Отдел 2"},statArr:{1:{time_type:"presence",time_rel:"18.9"},2:{time_type:"other",time_rel:"18.7"},3:{time_type:"absence",time_rel:"19"},4:{time_type:"presence",time_rel:"39.4"},5:{time_type:"absence",time_rel:"4"}},statSum:{presence:"8ч 23м",other:"4ч 20м",absence:"3ч 40м"}},5:{fullName:"Круглова Виктория Данииловна",department:{id:"2",name:"Отдел 2"},statArr:{1:{time_type:"presence",time_rel:"18.9"},2:{time_type:"other",time_rel:"18.7"},3:{time_type:"absence",time_rel:"19"},4:{time_type:"presence",time_rel:"39.4"},5:{time_type:"absence",time_rel:"4"}},statSum:{presence:"8ч 23м",other:"4ч 20м",absence:"3ч 40м"}},6:{fullName:"Седов Даниил Евгеньевич",department:{id:"3",name:"Отдел 3"},statArr:{1:{time_type:"presence",time_rel:"18.9"},2:{time_type:"other",time_rel:"18.7"},3:{time_type:"absence",time_rel:"19"},4:{time_type:"presence",time_rel:"39.4"},5:{time_type:"absence",time_rel:"4"}},statSum:{presence:"8ч 23м",other:"4ч 20м",absence:"3ч 40м"}},7:{fullName:"Анисимова София Владимировна",department:{id:"4",name:"Отдел 4"},statArr:{1:{time_type:"presence",time_rel:"18.9"},2:{time_type:"other",time_rel:"18.7"},3:{time_type:"absence",time_rel:"19"},4:{time_type:"presence",time_rel:"39.4"},5:{time_type:"absence",time_rel:"4"}},statSum:{presence:"8ч 23м",other:"4ч 20м",absence:"3ч 40м"}}},timelineWeek:{1:{fullName:"Фролова Олеся Матвеевна",department:{id:"1",name:"Отдел 1"},statArr:{1:{1:{time_type:"presence",time_rel:"10"},2:{time_type:"other",time_rel:"5"},3:{time_type:"relax",time_rel:"5"},4:{time_type:"absence",time_rel:"7"}},2:{1:{time_type:"presence",time_rel:"10"},2:{time_type:"other",time_rel:"5"},3:{time_type:"relax",time_rel:"5"},4:{time_type:"absence",time_rel:"7"}},3:{1:{time_type:"presence",time_rel:"10"},2:{time_type:"other",time_rel:"5"},3:{time_type:"relax",time_rel:"5"},4:{time_type:"absence",time_rel:"7"}},4:{1:{time_type:"presence",time_rel:"10"},2:{time_type:"other",time_rel:"5"},3:{time_type:"relax",time_rel:"5"},4:{time_type:"absence",time_rel:"7"}},5:{1:{time_type:"presence",time_rel:"10"},2:{time_type:"other",time_rel:"5"},3:{time_type:"relax",time_rel:"5"},4:{time_type:"absence",time_rel:"7"}},6:{1:{time_type:"presence",time_rel:"10"},2:{time_type:"other",time_rel:"5"},3:{time_type:"relax",time_rel:"5"},4:{time_type:"absence",time_rel:"7"}},7:{1:{time_type:"presence",time_rel:"10"},2:{time_type:"other",time_rel:"5"},3:{time_type:"relax",time_rel:"5"},4:{time_type:"absence",time_rel:"7"}}},statSum:{1:{presence:"8ч 23м",other:"4ч 20м",absence:"3ч 40м"},2:{presence:"8ч 23м",other:"4ч 20м",absence:"3ч 40м"},3:{presence:"8ч 23м",other:"4ч 20м",absence:"3ч 40м"},4:{presence:"8ч 23м",other:"4ч 20м",absence:"3ч 40м"},5:{presence:"8ч 23м",other:"4ч 20м",absence:"3ч 40м"},6:{presence:"8ч 23м",other:"4ч 20м",absence:"3ч 40м"},7:{presence:"8ч 23м",other:"4ч 20м",absence:"3ч 40м"},total:{presence:"8ч 23м",other:"4ч 20м",absence:"3ч 40м"}}},2:{fullName:"Симонов Артём Александрович",department:{id:"1",name:"Отдел 1"},statArr:{1:{1:{time_type:"presence",time_rel:"10"},2:{time_type:"other",time_rel:"5"},3:{time_type:"relax",time_rel:"5"},4:{time_type:"absence",time_rel:"7"}},2:{1:{time_type:"presence",time_rel:"10"},2:{time_type:"other",time_rel:"5"},3:{time_type:"relax",time_rel:"5"},4:{time_type:"absence",time_rel:"7"}},3:{1:{time_type:"presence",time_rel:"10"},2:{time_type:"other",time_rel:"5"},3:{time_type:"relax",time_rel:"5"},4:{time_type:"absence",time_rel:"7"}},4:{1:{time_type:"presence",time_rel:"10"},2:{time_type:"other",time_rel:"5"},3:{time_type:"relax",time_rel:"5"},4:{time_type:"absence",time_rel:"7"}},5:{1:{time_type:"presence",time_rel:"10"},2:{time_type:"other",time_rel:"5"},3:{time_type:"relax",time_rel:"5"},4:{time_type:"absence",time_rel:"7"}},6:{1:{time_type:"presence",time_rel:"10"},2:{time_type:"other",time_rel:"5"},3:{time_type:"relax",time_rel:"5"},4:{time_type:"absence",time_rel:"7"}},7:{1:{time_type:"presence",time_rel:"10"},2:{time_type:"other",time_rel:"5"},3:{time_type:"relax",time_rel:"5"},4:{time_type:"absence",time_rel:"7"}}},statSum:{1:{presence:"8ч 23м",other:"4ч 20м",absence:"3ч 40м"},2:{presence:"8ч 23м",other:"4ч 20м",absence:"3ч 40м"},3:{presence:"8ч 23м",other:"4ч 20м",absence:"3ч 40м"},4:{presence:"8ч 23м",other:"4ч 20м",absence:"3ч 40м"},5:{presence:"8ч 23м",other:"4ч 20м",absence:"3ч 40м"},6:{presence:"8ч 23м",other:"4ч 20м",absence:"3ч 40м"},7:{presence:"8ч 23м",other:"4ч 20м",absence:"3ч 40м"},total:{presence:"8ч 23м",other:"4ч 20м",absence:"3ч 40м"}}},3:{fullName:"Романова Кира Максимовна",department:{id:"2",name:"Отдел 2"},statArr:{1:{1:{time_type:"presence",time_rel:"10"},2:{time_type:"other",time_rel:"5"},3:{time_type:"relax",time_rel:"5"},4:{time_type:"absence",time_rel:"7"}},2:{1:{time_type:"presence",time_rel:"10"},2:{time_type:"other",time_rel:"5"},3:{time_type:"relax",time_rel:"5"},4:{time_type:"absence",time_rel:"7"}},3:{1:{time_type:"presence",time_rel:"10"},2:{time_type:"other",time_rel:"5"},3:{time_type:"relax",time_rel:"5"},4:{time_type:"absence",time_rel:"7"}},4:{1:{time_type:"presence",time_rel:"10"},2:{time_type:"other",time_rel:"5"},3:{time_type:"relax",time_rel:"5"},4:{time_type:"absence",time_rel:"7"}},5:{1:{time_type:"presence",time_rel:"10"},2:{time_type:"other",time_rel:"5"},3:{time_type:"relax",time_rel:"5"},4:{time_type:"absence",time_rel:"7"}},6:{1:{time_type:"presence",time_rel:"10"},2:{time_type:"other",time_rel:"5"},3:{time_type:"relax",time_rel:"5"},4:{time_type:"absence",time_rel:"7"}},7:{1:{time_type:"presence",time_rel:"10"},2:{time_type:"other",time_rel:"5"},3:{time_type:"relax",time_rel:"5"},4:{time_type:"absence",time_rel:"7"}}},statSum:{1:{presence:"8ч 23м",other:"4ч 20м",absence:"3ч 40м"},2:{presence:"8ч 23м",other:"4ч 20м",absence:"3ч 40м"},3:{presence:"8ч 23м",other:"4ч 20м",absence:"3ч 40м"},4:{presence:"8ч 23м",other:"4ч 20м",absence:"3ч 40м"},5:{presence:"8ч 23м",other:"4ч 20м",absence:"3ч 40м"},6:{presence:"8ч 23м",other:"4ч 20м",absence:"3ч 40м"},7:{presence:"8ч 23м",other:"4ч 20м",absence:"3ч 40м"},total:{presence:"8ч 23м",other:"4ч 20м",absence:"3ч 40м"}}},4:{fullName:"Мальцева Алиса Тимуровна",department:{id:"2",name:"Отдел 2"},statArr:{1:{1:{time_type:"presence",time_rel:"10"},2:{time_type:"other",time_rel:"5"},3:{time_type:"relax",time_rel:"5"},4:{time_type:"absence",time_rel:"7"}},2:{1:{time_type:"presence",time_rel:"10"},2:{time_type:"other",time_rel:"5"},3:{time_type:"relax",time_rel:"5"},4:{time_type:"absence",time_rel:"7"}},3:{1:{time_type:"presence",time_rel:"10"},2:{time_type:"other",time_rel:"5"},3:{time_type:"relax",time_rel:"5"},4:{time_type:"absence",time_rel:"7"}},4:{1:{time_type:"presence",time_rel:"10"},2:{time_type:"other",time_rel:"5"},3:{time_type:"relax",time_rel:"5"},4:{time_type:"absence",time_rel:"7"}},5:{1:{time_type:"presence",time_rel:"10"},2:{time_type:"other",time_rel:"5"},3:{time_type:"relax",time_rel:"5"},4:{time_type:"absence",time_rel:"7"}},6:{1:{time_type:"presence",time_rel:"10"},2:{time_type:"other",time_rel:"5"},3:{time_type:"relax",time_rel:"5"},4:{time_type:"absence",time_rel:"7"}},7:{1:{time_type:"presence",time_rel:"10"},2:{time_type:"other",time_rel:"5"},3:{time_type:"relax",time_rel:"5"},4:{time_type:"absence",time_rel:"7"}}},statSum:{1:{presence:"8ч 23м",other:"4ч 20м",absence:"3ч 40м"},2:{presence:"8ч 23м",other:"4ч 20м",absence:"3ч 40м"},3:{presence:"8ч 23м",other:"4ч 20м",absence:"3ч 40м"},4:{presence:"8ч 23м",other:"4ч 20м",absence:"3ч 40м"},5:{presence:"8ч 23м",other:"4ч 20м",absence:"3ч 40м"},6:{presence:"8ч 23м",other:"4ч 20м",absence:"3ч 40м"},7:{presence:"8ч 23м",other:"4ч 20м",absence:"3ч 40м"},total:{presence:"8ч 23м",other:"4ч 20м",absence:"3ч 40м"}}}},timelineMonth:{1:{fullName:"Фролова Олеся Матвеевна",department:{id:"1",name:"Отдел 1"},statArr:{1:{time_type:"presence",time_rel:"10"},2:{time_type:"other",time_rel:"5"},3:{time_type:"relax",time_rel:"5"},4:{time_type:"absence",time_rel:"7"},5:{time_type:"presence",time_rel:"30"},6:{time_type:"absence",time_rel:"15"}},statSum:{presence:"8ч 23м",other:"4ч 20м",absence:"3ч 40м"}},2:{fullName:"Симонов Артём Александрович",department:{id:"1",name:"Отдел 1"},statArr:{1:{time_type:"presence",time_rel:"18.9"},2:{time_type:"other",time_rel:"18.7"},3:{time_type:"absence",time_rel:"19"},4:{time_type:"presence",time_rel:"39.4"},5:{time_type:"absence",time_rel:"4"}},statSum:{presence:"8ч 23м",other:"4ч 20м",absence:"3ч 40м"}},3:{fullName:"Романова Кира Максимовна",department:{id:"2",name:"Отдел 2"},statArr:{1:{time_type:"presence",time_rel:"18.9"},2:{time_type:"other",time_rel:"18.7"},3:{time_type:"absence",time_rel:"19"},4:{time_type:"presence",time_rel:"39.4"},5:{time_type:"absence",time_rel:"4"}},statSum:{presence:"8ч 23м",other:"4ч 20м",absence:"3ч 40м"}},4:{fullName:"Мальцева Алиса Тимуровна",department:{id:"2",name:"Отдел 2"},statArr:{1:{time_type:"presence",time_rel:"18.9"},2:{time_type:"other",time_rel:"18.7"},3:{time_type:"absence",time_rel:"19"},4:{time_type:"presence",time_rel:"39.4"},5:{time_type:"absence",time_rel:"4"}},statSum:{presence:"8ч 23м",other:"4ч 20м",absence:"3ч 40м"}},5:{fullName:"Круглова Виктория Данииловна",department:{id:"2",name:"Отдел 2"},statArr:{1:{time_type:"presence",time_rel:"18.9"},2:{time_type:"other",time_rel:"18.7"},3:{time_type:"absence",time_rel:"19"},4:{time_type:"presence",time_rel:"39.4"},5:{time_type:"absence",time_rel:"4"}},statSum:{presence:"8ч 23м",other:"4ч 20м",absence:"3ч 40м"}},6:{fullName:"Седов Даниил Евгеньевич",department:{id:"3",name:"Отдел 3"},statArr:{1:{time_type:"presence",time_rel:"18.9"},2:{time_type:"other",time_rel:"18.7"},3:{time_type:"absence",time_rel:"19"},4:{time_type:"presence",time_rel:"39.4"},5:{time_type:"absence",time_rel:"4"}},statSum:{presence:"8ч 23м",other:"4ч 20м",absence:"3ч 40м"}},7:{fullName:"Анисимова София Владимировна",department:{id:"4",name:"Отдел 4"},statArr:{1:{time_type:"presence",time_rel:"18.9"},2:{time_type:"other",time_rel:"18.7"},3:{time_type:"absence",time_rel:"19"},4:{time_type:"presence",time_rel:"39.4"},5:{time_type:"absence",time_rel:"4"}},statSum:{presence:"8ч 23м",other:"4ч 20м",absence:"3ч 40м"}}}},_createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var TimelineDay=function(){function e(t,i){_classCallCheck(this,e),this.MAIN_WRAPPER=document.querySelector(t),this.timelineProps=i,this.tbl_inner_stat=null,this.datepicker=null,this.datepicker_input=null,this.dep_filter=null,this.user_filter=null,this.ajaxUrl="/",this.selectedDepart=0,this.selectedUser=0,this.selectedDate=0,this.departments={},this.users={},this.months=["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"],this.timeList=["9:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00"],this.periodType="day",this.settings()}return _createClass(e,[{key:"init",value:function(){this.MAIN_WRAPPER.dataset.wrap_period=this.periodType;var e=document.createDocumentFragment(),t=this.addElm("div","tbl-inner");this.render(t,this.tblHeader()),this.render(t,this.tblTimelineHeader()),this.render(t,this.tblTimelineStat()),this.render(t,this.tblTimelineInfo()),this.render(e,this.tblControls()),this.render(e,t),this.render(this.MAIN_WRAPPER,e)}},{key:"settings",value:function(){(!this.timelineProps.sum||this.timelineProps.sum.length<1)&&(this.timelineProps.sum=["presence","other","absence"]),this.timelineProps.items&&!this.isEmpty(this.timelineProps.items)||(this.timelineProps.items={presence:{color:"#25BF3E",caption:"Присутствие"},absence:{color:"#DD4F4F",caption:"Отсутствие"},other:{color:"#208FCD",caption:"Другой человек"},relax:{color:"#E4E4E4",caption:"Перерыв на отдых"}})}},{key:"tblTabs",value:function(e){var t=this.addElm("div","tbl-control-period-item","День"),i=this.addElm("div","tbl-control-period-item","Неделя"),r=this.addElm("div","tbl-control-period-item","Месяц");switch(t.dataset.period="day",i.dataset.period="week",r.dataset.period="month",this.periodType){case"day":t.classList.add("tbl-control-period-item-active");break;case"week":i.classList.add("tbl-control-period-item-active");break;case"month":r.classList.add("tbl-control-period-item-active");break;default:t.classList.add("tbl-control-period-item-active")}this.render(e,t),this.render(e,i),this.render(e,r)}},{key:"tblControls",value:function(){var e=document.createDocumentFragment(),t=this.addElm("div","tbl-control"),i=this.addElm("div","tbl-control-period");this.tblTabs(i);var r=this.addElm("div","tbl-control-filter");return this.render(r,this.loadFilter()),this.datepicker=this.addElm("div","tbl-control-datepicker"),this.loadFilterDate(this.datepicker),this.render(t,i),this.render(t,r),this.render(t,this.datepicker),this.render(e,t),this.handlers(),e}},{key:"loadFilter",value:function(){var e=document.createDocumentFragment();this.dep_filter=this.addElm("div","tbl-control-filter-item tbl-control-filter-dep"),this.dep_filter_list=this.addElm("div","tbl-control-filter-item-list tbl-control-filter-dep-list"),this.dep_filter_list.style.display="none";var t=this.addElm("div","tbl-control-filter-item-title","Отдел:"),i=this.addElm("div","tbl-control-filter-item-value","Все");i.dataset.id=i.dataset.id?i.dataset.id:0;var r=this.addElm("span","tbl-control-filter-arrow");this.user_filter=this.addElm("span","tbl-control-filter-item tbl-control-filter-user"),this.user_filter_list=this.addElm("div","tbl-control-filter-item-list tbl-control-filter-user-list"),this.user_filter_list.style.display="none";var s=this.addElm("span","tbl-control-filter-item-title","Сотрудник:");this.user_filter_item_value=this.addElm("span","tbl-control-filter-item-value","Все"),this.user_filter_item_value.dataset.id=this.user_filter_item_value.dataset.id?this.user_filter_item_value.dataset.id:0;var n=this.addElm("span","tbl-control-filter-arrow");return this.render(this.dep_filter,t),this.render(this.dep_filter,i),this.render(this.dep_filter,r),this.render(this.dep_filter,this.dep_filter_list),this.render(this.user_filter,s),this.render(this.user_filter,this.user_filter_item_value),this.render(this.user_filter,n),this.render(this.user_filter,this.user_filter_list),this.render(e,this.dep_filter),this.render(e,this.user_filter),e}},{key:"loadFilterDep",value:function(e){var t=this.departments;e.innerHTML="";var i=this.addElm("div","department-item filter-select-item","Все");for(var r in i.dataset.id=0,this.render(e,i),t){var s=this.addElm("div","department-item filter-select-item",t[r]);s.dataset.id=r,this.render(e,s)}}},{key:"loadFilterCollabs",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e.innerHTML="";var i=this.users,r=this.addElm("div","user-item filter-select-item","Все");for(var s in r.dataset.id=0,this.render(e,r),i){var n=this.addElm("div","user-item filter-select-item",i[s]);n.dataset.id=s,this.render(e,n)}null!==t&&(null!=i[0]?t.textContent=i[0].fullName:t.textContent="-")}},{key:"loadFilterDate",value:function(e){switch(this.dateFormat="d M Y",this.periodType){case"day":this.dateFormat="d M Y";break;case"week":this.dateFormat="d M Y - d M Y";break;case"month":this.dateFormat="M Y"}var t=new Date;t.setDate(t.getDate()-1);var i=this.addElm("label","datepicker-icon",this.getDateFormated(t,this.dateFormat));this.datepicker_input=this.addElm("input","datepicker-input","datepicker"),this.datepicker_input.type="date",this.datepicker_input.value=this.getDateFormated(t,"Y-m-d"),this.render(e,i),this.render(e,this.datepicker_input)}},{key:"tblHeader",value:function(){var e=document.createDocumentFragment(),t=this.addElm("div","tbl-inner-header");return t.innerHTML='\n            <div class="tbl-inner-header-item tbl-inner-header-fullname">ФИО</div>\n            <div class="tbl-inner-header-item tbl-inner-header-results">Результат контроля</div>\n        ',this.render(e,t),e}},{key:"tblTimelineHeader",value:function(){var e=document.createDocumentFragment(),t=this.addElm("div","tbl-inner-tline"),i=this.addElm("div","tbl-inner-tline-empty");if("month"==this.periodType){var r=this.addElm("div","tbl-inner-tline-info");r.innerHTML="<p>Внимание: В данной статистике выводит общее соотношение позиций за весь месяц!</p>",this.render(t,i),this.render(t,r)}else{for(var s=this.addElm("div","tbl-inner-tline-list"),n=0;n<this.timeList.length;n++){var l=this.addElm("div","tbl-inner-tline-list-item",this.timeList[n]);this.render(s,l)}this.render(t,i),this.render(t,s)}return this.render(e,t),e}},{key:"tblTimelineStat",value:function(){var e=document.createDocumentFragment();return this.tbl_inner_stat=this.addElm("div","tbl-inner-stat"),this.render(e,this.tbl_inner_stat),e}},{key:"tblTimelineInfo",value:function(){var e=document.createDocumentFragment(),t=this.addElm("div","tbl-info"),i=this.timelineProps.items,r=this.addElm("div","tbl-info-list");for(var s in i){var n=this.addElm("div","tbl-info-list-item tbl-info-list-item-"+s),l=this.addElm("div","marker");l.style.backgroundColor=i[s].color;var a=this.addElm("div","tbl-info-list-item-caption",i[s].caption);this.render(n,l),this.render(n,a),this.render(r,n)}return this.render(t,r),this.render(e,t),e}},{key:"loadTimline",value:function(e){for(var t in e)this.users[t]=e[t].fullName,this.departments[e[t].department.id]=e[t].department.name;this.loadFilterDep(this.dep_filter_list),this.loadFilterCollabs(this.user_filter_list);var i=this.timelineProps.sum,r=this.timelineProps.items;for(var s in this.tbl_inner_stat.innerHTML="",e){var n=e[s].fullName,l=e[s].statArr,a=e[s].statSum,m=this.addElm("div","tbl-inner-stat-item"),o=this.addElm("div","tbl-inner-stat-person"),d=this.addElm("div","tbl-inner-stat-person-name",n),c=this.addElm("div","tbl-inner-stat-person-sum"),p=this.addElm("span","","("),_=this.addElm("span","",")");for(var h in this.render(c,p),r)if(i.includes(h)){var y=this.addElm("span","timetype timetype-"+h,a[h]);y.style.color=r[h].color,this.render(c,y)}this.render(c,_),this.render(o,d),this.render(o,c);var u=this.addElm("div","tbl-inner-stat-item-scale");for(var b in l){var f=l[b].time_type,v=l[b].time_rel,g=this.addElm("div","bg-timeline-item");g.classList.add("bg-timeline-"+f),g.style.width=parseFloat(v)+"%",g.style.backgroundColor=r[f].color,this.render(u,g)}this.render(m,o),this.render(m,u),this.render(this.tbl_inner_stat,m)}}},{key:"ajaxUpdate",value:async function(){this.setControls(),console.log("\n            this.selectedDate: "+this.selectedDate+"\n            this.selectedDepart: "+this.selectedDepart+"\n            this.selectedUser: "+this.selectedUser+"\n            this.periodType: "+this.periodType+"\n        ");var e={date:this.selectedDate,depart:this.selectedDepart,users:this.selectedUser,periodType:this.periodType},t={method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify(e)},i=fetch(this.ajaxUrl,t),r=await i.json();this.loadTimline(r)}},{key:"handlers",value:function(){var e=this;this.datepicker_input.addEventListener("change",(function(t){var i=t.target.value,r=Date.parse(i);e.selectedDate=new Date(r);var s=e.getDateFormated(e.selectedDate,e.dateFormat);s.includes("NaN")||s.includes("undefined")||(e.datepicker.querySelector("label").textContent=s,e.ajaxUpdate())})),this.dep_filter.addEventListener("click",(function(t){var i=t.currentTarget.querySelector(".tbl-control-filter-item-list");if(i.style.display="none"==i.style.display?"flex":"none",t.target.classList.contains("filter-select-item")){var r=t.currentTarget.querySelector(".tbl-control-filter-item-value");r.textContent=t.target.textContent;var s=t.target.dataset.id;r.dataset.id=s;var n=e.timelineProps.users,l=[];for(var a in n){n[a].depart_id==s&&l.push(n[a])}e.ajaxUpdate()}})),this.user_filter.addEventListener("click",(function(t){var i=t.currentTarget.querySelector(".tbl-control-filter-item-list");if(i.style.display="none"==i.style.display?"flex":"none",t.target.classList.contains("filter-select-item")){var r=t.currentTarget.querySelector(".tbl-control-filter-item-value");r.dataset.id=t.target.dataset.id,r.textContent=t.target.textContent,e.ajaxUpdate()}})),document.addEventListener("keydown",(function(e){"Escape"==e.code&&(e.target.classList.contains("tbl-control-filter-item")||document.querySelectorAll(".tbl-control-filter-item-list").forEach((function(e){e.style.display="none"})))})),document.addEventListener("click",(function(e){e.target.classList.contains("tbl-control-filter-item")||e.target.classList.contains("tbl-control-filter-item-title")||e.target.classList.contains("tbl-control-filter-item-value")||e.target.classList.contains("tbl-control-filter-arrow")||e.target.classList.contains("tbl-control-filter-item-list")||e.target.classList.contains("filter-select-item")||e.target.classList.contains("tbl-control-filter-item")||document.querySelectorAll(".tbl-control-filter-item-list").forEach((function(e){e.style.display="none"}))}))}},{key:"setControls",value:function(){var e=document.querySelector(".tbl-control-filter-dep .tbl-control-filter-item-value"),t=document.querySelector(".tbl-control-filter-user .tbl-control-filter-item-value"),i=document.querySelector(".tbl-control-datepicker input.datepicker-input");this.selectedDepart=e?e.dataset.id:0,this.selectedUser=t?t.dataset.id:0,this.selectedDate=i?i.value:0}},{key:"addElm",value:function(e){var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"",a=document.createElement(e);return i&&(t=a.classList).add.apply(t,_toConsumableArray(i.split(" "))),r&&(a.textContent=r),s&&(a.id=s),n&&(a.href=n),l&&(a.title=l),a}},{key:"render",value:function(e,t){e.appendChild(t)}},{key:"isEmpty",value:function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return JSON.stringify(e)===JSON.stringify({})}},{key:"getDateFormated",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"d M Y";switch(t){case"d M Y":return e.getDate()+" "+this.months[e.getMonth()]+" "+e.getFullYear();case"Y-m-d":var i=e.getMonth()+1,r=e.getDate();return e.getMonth()<10&&(i="0"+i),e.getDate()<10&&(r="0"+r),e.getFullYear()+"-"+i+"-"+r;case"M Y":return this.months[e.getMonth()]+" "+e.getFullYear();case"d M Y - d M Y":var s=e,n=new Date(e.getFullYear(),e.getMonth(),e.getDate());return s.setDate(s.getDate()-s.getDay()+1),n.setDate(n.getDate()+(7-n.getDay())),s.getDate()+" "+this.months[s.getMonth()]+" "+s.getFullYear()+" - "+n.getDate()+" "+this.months[n.getMonth()]+" "+n.getFullYear();default:return e.getDate()+" "+this.months[e.getMonth()]+" "+e.getFullYear()}}},{key:"isParentContainChild",value:function(e,t){return e!==t&&e.contains(t)}}]),e}(),TimelineMonth=function(e){function t(){var e;_classCallCheck(this,t);for(var i=arguments.length,r=Array(i),s=0;s<i;s++)r[s]=arguments[s];var n=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(r)));return n.months=["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],n.periodType="month",n}return _inherits(t,TimelineDay),t}(),TimelineWeek=function(e){function t(){var e;_classCallCheck(this,t);for(var i=arguments.length,r=Array(i),s=0;s<i;s++)r[s]=arguments[s];var n=_possibleConstructorReturn(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(r)));return n.timeList=["Пон","Вт","Ср","Чт","Пт","Сб","Вс"],n.periodType="week",n}return _inherits(t,TimelineDay),_createClass(t,[{key:"loadTimline",value:function(e){for(var t in e)this.users[t]=e[t].fullName,this.departments[e[t].department.id]=e[t].department.name;this.loadFilterDep(this.dep_filter_list),this.loadFilterCollabs(this.user_filter_list);var i=this.timelineProps.sum,r=this.timelineProps.items;for(var s in this.tbl_inner_stat.innerHTML="",e){var n=e[s].fullName,l=e[s].statArr,a=e[s].statSum,m=this.addElm("div","tbl-inner-stat-item"),o=this.addElm("div","tbl-inner-stat-person"),d=this.addElm("div","tbl-inner-stat-person-name",n),c=this.addElm("div","tbl-inner-stat-person-sum"),p=this.addElm("span","","("),_=this.addElm("span","",")");for(var h in this.render(c,p),r)if(i.includes(h)){var y=this.addElm("span","timetype timetype-"+h,a.total[h]);y.style.color=r[h].color,this.render(c,y)}this.render(c,_),this.render(o,d),this.render(o,c);var u=this.addElm("div","tbl-inner-stat-item-scale timeline-week");for(var b in l){var f=l[b],v=this.addElm("div","timeline-week-item"),g=this.addElm("div","timeline-week-item-scale");for(var E in f){var k=this.addElm("div","bg-timeline-item-scale bg-timeline-"+f[E].time_type);k.style.width=parseFloat(f[E].time_rel)+"%",k.style.backgroundColor=r[f[E].time_type].color,this.render(g,k)}var D=this.addElm("div","timeline-week-item-sum"),x=this.addElm("span","timetype-presence",a[b].presence),T=this.addElm("span","timetype-other",a[b].other),S=this.addElm("span","timetype-absence",a[b].absence);this.render(D,x),this.render(D,T),this.render(D,S),this.render(v,g),this.render(v,D),this.render(u,v)}this.render(m,o),this.render(m,u),this.render(this.tbl_inner_stat,m)}}}]),t}();window.onload=function(){document.querySelectorAll(".tbl-control-period-item").forEach((function(e){e.addEventListener("click",(function(e){var t=e.currentTarget.dataset.period,i=document.querySelectorAll("[data-wrap_period]"),r=document.querySelector("[data-wrap_period="+t+"]");i.forEach((function(e){e.style.display="none"})),r.style.display="block"}))}))};